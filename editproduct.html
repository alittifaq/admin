<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Input Form Product</title>
    <link rel="stylesheet" href="productform.css" />
  </head>
  <body>
    <div id="container">
      <div class="formWrapper">
        <div id="inputfile">
          <h2>Update Image</h2>
          <div id="fileInputWrapper">
            <input type="file" id="imageInput" accept="image/*" capture />
            <button onclick="uploadImage()">Upload Image</button>
          </div>
        </div>
        <form id="edit-product-form">
          <input type="hidden" id="product-id" name="product-id" />
          <div>
            <label for="product-name">Nama Produk</label>
            <input type="text" id="product-name" name="product-name" required />
          </div>
          <div>
            <label for="product-photo">Foto URL</label>
            <input
              type="text"
              id="product-photo"
              name="product-photo"
              required
            />
          </div>
          <button type="submit">Update Product</button>
        </form>
      </div>
    </div>
    <script type="module" src="./index.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get("id");

        if (!productId) {
          console.error("No product ID found in URL");
          return;
        }

        try {
          const response = await fetch(
            `https://asia-southeast2-blkkalittifaq-426014.cloudfunctions.net/blkkalittifaq/data/product/${productId}`
          );
          const product = await response.json();

          // Populate form fields with product data
          document.getElementById("product-id").value = product._id;
          document.getElementById("product-name").value = product.nama;
          document.getElementById("product-photo").value = product.foto;
        } catch (error) {
          console.error("Error loading product data:", error);
        }
      });

      document
        .getElementById("edit-product-form")
        .addEventListener("submit", async function (event) {
          event.preventDefault();

          const productId = document.getElementById("product-id").value;
          const productName = document.getElementById("product-name").value;
          const productPhoto = document.getElementById("product-photo").value;

          const updateData = {
            _id: productId,
            nama: productName,
            foto: productPhoto,
          };

          try {
            const response = await fetch(
              `https://asia-southeast2-blkkalittifaq-426014.cloudfunctions.net/blkkalittifaq/data/product`,
              {
                method: "PUT",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(updateData),
              }
            );

            if (!response.ok) {
              throw new Error("Network response was not ok");
            }

            const updatedProduct = await response.json();
            console.log("Update Success:", updatedProduct);
            alert("Produk berhasil diperbarui!");
            // Redirect back to the product list
            window.location.href = "index.html";
          } catch (error) {
            console.error("Error updating product:", error);
            alert("Gagal memperbarui produk, coba lagi ya!");
          }
        });
    </script>
  </body>
</html>
